<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>infodrop Minecraft æœåŠ¡å™¨æ³¨å†Œ</title>
    <style>
        .auth-wrapper { background-color: var(--light-glass-bg); border-radius: var(--border-radius); margin: 10px; padding: 30px; font-size: 14px; }
        .auth-wrapper h1 { font-size: 1.8rem; font-weight: 600; margin-bottom: 0.5rem; padding-left: 15px; }
        .auth-wrapper .lead { padding: 0 15px 15px; margin-bottom: 2rem; font-size: 1rem; font-weight: 400; color: var(--light-text-secondary); border-bottom: 1px solid var(--light-border, rgba(0, 0, 0, 0.1)); }
        .form-group { margin-bottom: 1.5rem; padding: 0 15px; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 0.5rem; }
        .form-group input[type="text"],
        .form-group input[type="password"] { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--light-border, rgba(0, 0, 0, 0.15)); background-color: rgba(255, 255, 255, 0.5); font-size: 1rem; transition: border-color 0.3s, box-shadow 0.3s; box-sizing: border-box; }
        .form-group input[type="text"]:focus,
        .form-group input[type="password"]:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.25); }
        .btn { display: inline-block; padding: 12px 25px; font-size: 1rem; font-weight: 500; text-align: center; border-radius: 8px; border: none; cursor: pointer; transition: background-color 0.3s, transform 0.2s; }
        .btn-primary { background-color: var(--accent-color); color: white; width: 100%; }
        .btn:disabled { background-color: #e4e6eb; color: #bcc0c4; cursor: not-allowed; }
        .btn-primary:hover:not(:disabled) { background-color: var(--accent-color-hover); }
        .btn:active { transform: scale(0.98); }
        #quiz-section { display: none; }
        #result-message { display: none; margin-top: 2rem; padding: 20px; border-radius: 10px; font-size: 1.1rem; font-weight: 500; text-align: center; line-height: 1.8; }
        .result-success { background-color: rgba(40, 201, 64, 0.15); color: #28C940; }
        .result-fail { background-color: rgba(255, 95, 87, 0.2); color: #FF5F57; }
        .result-processing { background-color: rgba(0, 122, 255, 0.1); color: var(--accent-color); }
        #result-message.result-success strong {
            display: inline-block;
            font-family: 'SF Mono', 'Menlo', 'Consolas', monospace;
            font-size: 2.2rem;
            color: var(--accent-color);
            letter-spacing: 3px;
            padding: 10px 20px;
            margin: 10px 0;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            user-select: all;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #result-message.result-success strong:hover {
            background-color: #f0f0f0;
        }
        .input-with-button {
            position: relative;
            width: 100%;
        }
        .input-with-button input[type="password"],
        .input-with-button input[type="text"] {
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--light-border, rgba(0, 0, 0, 0.15)); background-color: rgba(255, 255, 255, 0.5); font-size: 1rem; transition: border-color 0.3s, box-shadow 0.3s; box-sizing: border-box;
            padding-right: 65px;
        }
        .input-with-button input[type="password"]:focus,
        .input-with-button input[type="text"]:focus {
            outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.25);
        }
        .password-toggle-btn {
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
            padding: 6px 10px;
            font-size: 0.85rem;
            font-weight: 500;
            border-radius: 5px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            color: #333;
            cursor: pointer;
            transition: all 0.2s;
        }
        .password-toggle-btn:hover {
            background-color: #e0e0e0;
        }
        .password-toggle-btn.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        .macos-window.dark-mode .auth-wrapper,
        html.dark-mode .auth-wrapper { background-color: var(--dark-glass-bg); }
        .macos-window.dark-mode .auth-wrapper h1,
        .macos-window.dark-mode .auth-wrapper .lead,
        html.dark-mode .auth-wrapper h1,
        html.dark-mode .auth-wrapper .lead { color: var(--dark-text); }
        .macos-window.dark-mode .auth-wrapper .lead,
        html.dark-mode .auth-wrapper .lead { border-bottom-color: var(--dark-border, rgba(255, 255, 255, 0.15)); }
        .macos-window.dark-mode .form-group input[type="text"],
        .macos-window.dark-mode .form-group input[type="password"],
        html.dark-mode .form-group input[type="text"],
        html.dark-mode .form-group input[type="password"] { border-color: var(--dark-border, rgba(255, 255, 255, 0.2)); background-color: rgba(0, 0, 0, 0.2); color: var(--dark-text); }
        .macos-window.dark-mode .result-success,
        html.dark-mode .result-success { background-color: rgba(40, 201, 64, 0.2); }
        .macos-window.dark-mode #result-message.result-success strong,
        html.dark-mode #result-message.result-success strong { background-color: rgba(0, 0, 0, 0.25); color: #8ab4f8; }
        .macos-window.dark-mode #result-message.result-success strong:hover,
        html.dark-mode #result-message.result-success strong:hover { background-color: rgba(0, 0, 0, 0.4); }
        .macos-window.dark-mode .input-with-button input[type="password"],
        .macos-window.dark-mode .input-with-button input[type="text"],
        html.dark-mode .input-with-button input[type="password"],
        html.dark-mode .input-with-button input[type="text"] {
            border-color: var(--dark-border, rgba(255, 255, 255, 0.2));
            background-color: rgba(0, 0, 0, 0.2);
            color: var(--dark-text);
        }
        .macos-window.dark-mode .password-toggle-btn,
        html.dark-mode .password-toggle-btn {
            background-color: rgba(0, 0, 0, 0.3);
            border-color: var(--dark-border, rgba(255, 255, 255, 0.2));
            color: var(--dark-text);
        }
        .macos-window.dark-mode .password-toggle-btn.active,
        html.dark-mode .password-toggle-btn.active {
            background-color: var(--accent-color);
            color: white;
        }
        @media (max-width: 768px) {
            .auth-wrapper {
                padding: 20px;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="auth-wrapper">
        <form id="register-form">
            <h1>ğŸ® Minecraft æœåŠ¡å™¨æ³¨å†Œ</h1>
            <p class="lead">æ¬¢è¿æ¥åˆ° infodrop çš„ Minecraft æœåŠ¡å™¨ã€‚æ¯ä¸ªQQå·ä»…é™æ³¨å†Œä¸€ä¸ªè´¦æˆ·ã€‚</p>

            <div class="form-group">
                <label for="qq-number">è¯·è¾“å…¥æ‚¨çš„QQå·</label>
                <input type="text" inputmode="numeric" id="qq-number" name="qq"
                       placeholder="ç”¨äºéªŒè¯ï¼Œæ¯ä¸ªQQå·é™æ³¨å†Œä¸€æ¬¡"
                       oninput="this.value=this.value.replace(/[^\d]/g,'')" required>
            </div>

            <div class="form-group">
                <label for="mc-username">Minecraft ç”¨æˆ·å</label>
                <input type="text" id="mc-username" name="username"
                       placeholder="æ¸¸æˆå†…æ˜µç§° (3-16ä½, å­—æ¯/æ•°å­—/ä¸‹åˆ’çº¿)"
                       pattern="[a-zA-Z0-9_]{3,16}"
                       title="å¿…é¡»ä¸º3-16ä½çš„å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿" required>
            </div>
            
            <div class="form-group">
                <label for="mc-password">è®¾ç½®å¯†ç </label>
                <div class="input-with-button">
                    <input type="password" id="mc-password" name="password"
                           placeholder="ç”¨äºæ¸¸æˆå†… /login (è‡³å°‘4ä½)"
                           minlength="4"
                           title="è‡³å°‘éœ€è¦4ä¸ªå­—ç¬¦" required>
                    <button type="button" class="password-toggle-btn" id="toggle-password">æ˜¾ç¤º</button>
                </div>
            </div>
            
            <div class="form-group">
                <label for="mc-password-confirm">ç¡®è®¤å¯†ç </label>
                <div class="input-with-button">
                    <input type="password" id="mc-password-confirm" name="password_confirm"
                           placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
                           minlength="4"
                           title="è¯·å†æ¬¡è¾“å…¥å¯†ç " required>
                    <button type="button" class="password-toggle-btn" id="toggle-password-confirm">æ˜¾ç¤º</button>
                </div>
            </div>

            <div class="form-group">
                <button type="submit" id="register-btn" class="btn btn-primary">æ³¨å†Œå¹¶ç»‘å®šQQ</button>
            </div>
        </form>
        
        <div id="result-message"></div>
    </div>

    <script>
    (function() {
        const componentRoot = document.querySelector('.auth-wrapper');
        if (!componentRoot) {
            console.error("Auth component root could not be found!");
            return;
        }

        const registerForm = componentRoot.querySelector('#register-form');
        const submitBtn = componentRoot.querySelector('#register-btn');
        const resultMessage = componentRoot.querySelector('#result-message');
        
        const passwordInput = componentRoot.querySelector('#mc-password');
        const passwordConfirmInput = componentRoot.querySelector('#mc-password-confirm');
        
        const togglePasswordBtn = componentRoot.querySelector('#toggle-password');
        const togglePasswordConfirmBtn = componentRoot.querySelector('#toggle-password-confirm');
        
        const qqPattern = /^\d{5,12}$/;
        const usernamePattern = /^[a-zA-Z0-9_]{3,16}$/;
        const minPasswordLength = 4;

        function setupPasswordToggle(inputElement, toggleButtonElement) {
            let isPasswordVisible = false;
            
            toggleButtonElement.addEventListener('click', function() {
                isPasswordVisible = !isPasswordVisible;
                
                if (isPasswordVisible) {
                    inputElement.type = 'text';
                    toggleButtonElement.textContent = 'éšè—';
                    toggleButtonElement.classList.add('active');
                } else {
                    inputElement.type = 'password';
                    toggleButtonElement.textContent = 'æ˜¾ç¤º';
                    toggleButtonElement.classList.remove('active');
                }
            });
        }

        if (passwordInput && togglePasswordBtn) {
            setupPasswordToggle(passwordInput, togglePasswordBtn);
        }
        if (passwordConfirmInput && togglePasswordConfirmBtn) {
            setupPasswordToggle(passwordConfirmInput, togglePasswordConfirmBtn);
        }
        
        async function handleRegistration(e) {
            e.preventDefault();
            
            const formData = new FormData(registerForm);
            const qq = formData.get('qq');
            const username = formData.get('username');
            const password = formData.get('password');
            const passwordConfirm = formData.get('password_confirm');

            if (password !== passwordConfirm) {
                alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´ï¼Œè¯·æ£€æŸ¥ã€‚');
                return;
            }
            if (!qqPattern.test(qq)) {
                alert('è¯·è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆçš„QQå·ï¼');
                return;
            }
            if (!usernamePattern.test(username)) {
                alert('ç”¨æˆ·åæ— æ•ˆã€‚å¿…é¡»ä¸º3-16ä½çš„å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿ã€‚');
                return;
            }
            if (password.length < minPasswordLength) {
                alert('å¯†ç å¤ªçŸ­ã€‚æœ€å°é•¿åº¦ä¸º4ä¸ªå­—ç¬¦ã€‚');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'æ­£åœ¨æäº¤...';
            resultMessage.style.display = 'block';
            resultMessage.className = 'result-processing';
            resultMessage.textContent = 'æ­£åœ¨æ³¨å†Œï¼Œè¯·ç¨å...';

            try {
                const response = await fetch('./minecraft/reg.php', {
                    method: 'POST',
                    body: formData,
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.message || 'æœåŠ¡å™¨å‘ç”ŸæœªçŸ¥é”™è¯¯ã€‚');
                }

                resultMessage.innerHTML = result.message;
                resultMessage.className = result.success ? 'result-success' : 'result-fail';

            } catch (error) {
                console.error("æ³¨å†Œå¤±è´¥:", error);
                resultMessage.innerHTML = "æ³¨å†Œå¤±è´¥ï¼š" + error.message;
                resultMessage.className = 'result-fail';
            
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'æ³¨å†Œå¹¶ç»‘å®šQQ';
            }
        }

        if (registerForm) {
            registerForm.addEventListener('submit', handleRegistration);
        }
    })();
    </script>
</body>
</html>
