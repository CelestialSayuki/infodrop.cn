<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>infodrop Minecraft ÊúçÂä°Âô®Ê≥®ÂÜå</title>
    <style>
        .auth-wrapper { background-color: var(--light-glass-bg); border-radius: var(--border-radius); margin: 10px; padding: 30px; font-size: 14px; }
        .auth-wrapper h1 { font-size: 1.8rem; font-weight: 600; margin-bottom: 0.5rem; padding-left: 15px; }
        .auth-wrapper .lead { padding: 0 15px 15px; margin-bottom: 2rem; font-size: 1rem; font-weight: 400; color: var(--light-text-secondary); border-bottom: 1px solid var(--light-border, rgba(0, 0, 0, 0.1)); }
        .form-group { margin-bottom: 1.5rem; padding: 0 15px; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 0.5rem; }
        .form-group input[type="text"],
        .form-group input[type="password"] { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--light-border, rgba(0, 0, 0, 0.15)); background-color: rgba(255, 255, 255, 0.5); font-size: 1rem; transition: border-color 0.3s, box-shadow 0.3s; box-sizing: border-box; }
        .form-group input[type="text"]:focus,
        .form-group input[type="password"]:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.25); }
        .btn { display: inline-block; padding: 12px 25px; font-size: 1rem; font-weight: 500; text-align: center; border-radius: 8px; border: none; cursor: pointer; transition: background-color 0.3s, transform 0.2s; }
        .btn-primary { background-color: var(--accent-color); color: white; width: 100%; }
        .btn:disabled { background-color: #e4e6eb; color: #bcc0c4; cursor: not-allowed; }
        .btn-primary:hover:not(:disabled) { background-color: var(--accent-color-hover); }
        .btn:active { transform: scale(0.98); }
        #quiz-section { display: none; }
        #result-message { display: none; margin-top: 2rem; padding: 20px; border-radius: 10px; font-size: 1.1rem; font-weight: 500; text-align: center; line-height: 1.8; }
        .result-success { background-color: rgba(40, 201, 64, 0.15); color: #28C940; }
        .result-fail { background-color: rgba(255, 95, 87, 0.2); color: #FF5F57; }
        .result-processing { background-color: rgba(0, 122, 255, 0.1); color: var(--accent-color); }
        #result-message.result-success strong {
            display: inline-block;
            font-family: 'SF Mono', 'Menlo', 'Consolas', monospace;
            font-size: 2.2rem;
            color: var(--accent-color);
            letter-spacing: 3px;
            padding: 10px 20px;
            margin: 10px 0;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            user-select: all;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #result-message.result-success strong:hover {
            background-color: #f0f0f0;
        }
        .input-with-button {
            position: relative;
            width: 100%;
        }
        .input-with-button input[type="password"],
        .input-with-button input[type="text"] {
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--light-border, rgba(0, 0, 0, 0.15)); background-color: rgba(255, 255, 255, 0.5); font-size: 1rem; transition: border-color 0.3s, box-shadow 0.3s; box-sizing: border-box;
            padding-right: 65px;
        }
        .input-with-button input[type="password"]:focus,
        .input-with-button input[type="text"]:focus {
            outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.25);
        }
        .password-toggle-btn {
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
            padding: 6px 10px;
            font-size: 0.85rem;
            font-weight: 500;
            border-radius: 5px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            color: #333;
            cursor: pointer;
            transition: all 0.2s;
        }
        .password-toggle-btn:hover {
            background-color: #e0e0e0;
        }
        .password-toggle-btn.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        .copyable-server-address {
            display: block;
            font-family: 'SF Mono', 'Menlo', 'Consolas', monospace;
            font-size: 0.9rem;
            color: var(--accent-color, #007aff);
            letter-spacing: 0.5px;
            padding: 10px 12px;
            margin-top: 4px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            user-select: all;
            cursor: pointer;
            transition: background-color 0.2s;
            word-break: break-all;
        }
        .copyable-server-address:hover {
            background-color: #f0f0f0;
        }
        .macos-window.dark-mode .auth-wrapper,
        html.dark-mode .auth-wrapper { background-color: var(--dark-glass-bg); }
        .macos-window.dark-mode .auth-wrapper h1,
        .macos-window.dark-mode .auth-wrapper .lead,
        html.dark-mode .auth-wrapper h1,
        html.dark-mode .auth-wrapper .lead { color: var(--dark-text); }
        .macos-window.dark-mode .auth-wrapper .lead,
        html.dark-mode .auth-wrapper .lead { border-bottom-color: var(--dark-border, rgba(255, 255, 255, 0.15)); }
        .macos-window.dark-mode .form-group input[type="text"],
        .macos-window.dark-mode .form-group input[type="password"],
        html.dark-mode .form-group input[type="text"],
        html.dark-mode .form-group input[type="password"] { border-color: var(--dark-border, rgba(255, 255, 255, 0.2)); background-color: rgba(0, 0, 0, 0.2); color: var(--dark-text); }
        .macos-window.dark-mode .result-success,
        html.dark-mode .result-success { background-color: rgba(40, 201, 64, 0.2); }
        .macos-window.dark-mode #result-message.result-success strong,
        html.dark-mode #result-message.result-success strong { background-color: rgba(0, 0, 0, 0.25); color: #8ab4f8; }
        .macos-window.dark-mode #result-message.result-success strong:hover,
        html.dark-mode #result-message.result-success strong:hover { background-color: rgba(0, 0, 0, 0.4); }
        .macos-window.dark-mode .input-with-button input[type="password"],
        .macos-window.dark-mode .input-with-button input[type="text"],
        html.dark-mode .input-with-button input[type="password"],
        html.dark-mode .input-with-button input[type="text"] {
            border-color: var(--dark-border, rgba(255, 255, 255, 0.2));
            background-color: rgba(0, 0, 0, 0.2);
            color: var(--dark-text);
        }
        .macos-window.dark-mode .password-toggle-btn,
        html.dark-mode .password-toggle-btn {
            background-color: rgba(0, 0, 0, 0.3);
            border-color: var(--dark-border, rgba(255, 255, 255, 0.2));
            color: var(--dark-text);
        }
        .macos-window.dark-mode .password-toggle-btn.active,
        html.dark-mode .password-toggle-btn.active {
            background-color: var(--accent-color);
            color: white;
        }
        html.dark-mode .copyable-server-address {
            background-color: rgba(0, 0, 0, 0.25);
            color: #8ab4f8;
        }
        html.dark-mode .copyable-server-address:hover {
            background-color: rgba(0, 0, 0, 0.4);
        }
        @media (max-width: 768px) {
            .auth-wrapper {
                padding: 20px;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="auth-wrapper">
        <form id="register-form">
            <h1>üéÆ Minecraft ÊúçÂä°Âô®Ê≥®ÂÜå</h1>
            <p class="lead">Ê¨¢ËøéÊù•Âà∞ infodrop ÁöÑ Minecraft ÊúçÂä°Âô®„ÄÇÊØè‰∏™QQÂè∑‰ªÖÈôêÊ≥®ÂÜå‰∏Ä‰∏™Ë¥¶Êà∑„ÄÇ</p>

            <div class="form-group">
                <label>ÊúçÂä°Âô®Âú∞ÂùÄ</label>
                <div class="copyable-server-address" data-copy-text="mc.infodrop.cn">mc.infodrop.cn</div>
            </div>
            <div class="form-group">
                <label for="qq-number">ËØ∑ËæìÂÖ•ÊÇ®ÁöÑQQÂè∑</label>
                <input type="text" inputmode="numeric" id="qq-number" name="qq"
                       placeholder="Áî®‰∫éÈ™åËØÅÔºåÊØè‰∏™QQÂè∑ÈôêÊ≥®ÂÜå‰∏ÄÊ¨°"
                       oninput="this.value=this.value.replace(/[^\d]/g,'')" required>
            </div>

            <div class="form-group">
                <label for="mc-username">ÊÇ®ÁöÑ Minecraft Áî®Êà∑Âêç</label>
                <input type="text" id="mc-username" name="username"
                       placeholder="Ê∏∏ÊàèÂÜÖÁöÑÊòµÁß∞ (3-16‰Ωç, Â≠óÊØç/Êï∞Â≠ó/‰∏ãÂàíÁ∫ø), ËØ∑Âä°ÂøÖÂØπÂ∫îÔºÅÂê¶ÂàôÂ∞ÜÊó†Ê≥ïÁôªÂΩï"
                       pattern="[a-zA-Z0-9_]{3,16}"
                       title="ÂøÖÈ°ª‰∏∫3-16‰ΩçÁöÑÂ≠óÊØç„ÄÅÊï∞Â≠óÊàñ‰∏ãÂàíÁ∫ø" required>
            </div>
            
            <div class="form-group">
                <label for="mc-password">ËÆæÁΩÆÂØÜÁ†Å</label>
                <div class="input-with-button">
                    <input type="password" id="mc-password" name="password"
                           placeholder="Áî®‰∫éÊ∏∏ÊàèÂÜÖ /login (Ëá≥Â∞ë4‰Ωç)"
                           minlength="4"
                           title="Ëá≥Â∞ëÈúÄË¶Å4‰∏™Â≠óÁ¨¶" required>
                    <button type="button" class="password-toggle-btn" id="toggle-password">ÊòæÁ§∫</button>
                </div>
            </div>
            
            <div class="form-group">
                <label for="mc-password-confirm">Á°ÆËÆ§ÂØÜÁ†Å</label>
                <div class="input-with-button">
                    <input type="password" id="mc-password-confirm" name="password_confirm"
                           placeholder="ËØ∑ÂÜçÊ¨°ËæìÂÖ•ÂØÜÁ†Å"
                           minlength="4"
                           title="ËØ∑ÂÜçÊ¨°ËæìÂÖ•ÂØÜÁ†Å" required>
                    <button type="button" class="password-toggle-btn" id="toggle-password-confirm">ÊòæÁ§∫</button>
                </div>
            </div>

            <div class="form-group">
                <button type="submit" id="register-btn" class="btn btn-primary">Ê≥®ÂÜåÂπ∂ÁªëÂÆöQQ</button>
            </div>
        </form>
        
        <div id="result-message"></div>
    </div>

    <script>
    (function() {
        const componentRoot = document.querySelector('.auth-wrapper');
        if (!componentRoot) {
            console.error("Auth component root could not be found!");
            return;
        }
        const copyableAddress = componentRoot.querySelector('.copyable-server-address');
        if (copyableAddress) {
            copyableAddress.addEventListener('click', function() {
                const textToCopy = copyableAddress.dataset.copyText || copyableAddress.textContent;
                const originalText = copyableAddress.textContent;
                
                navigator.clipboard.writeText(textToCopy).then(() => {
                    copyableAddress.textContent = 'Â∑≤Â§çÂà∂!';
                    setTimeout(() => {
                        copyableAddress.textContent = originalText;
                    }, 2000);
                }).catch(err => {
                    console.error('Êó†Ê≥ïÂ§çÂà∂: ', err);
                    copyableAddress.textContent = 'Â§çÂà∂Â§±Ë¥•';
                    setTimeout(() => {
                        copyableAddress.textContent = originalText;
                    }, 2000);
                });
            });
        }
        const registerForm = componentRoot.querySelector('#register-form');
        const submitBtn = componentRoot.querySelector('#register-btn');
        const resultMessage = componentRoot.querySelector('#result-message');
        
        const passwordInput = componentRoot.querySelector('#mc-password');
        const passwordConfirmInput = componentRoot.querySelector('#mc-password-confirm');
        
        const togglePasswordBtn = componentRoot.querySelector('#toggle-password');
        const togglePasswordConfirmBtn = componentRoot.querySelector('#toggle-password-confirm');
        
        const qqPattern = /^\d{5,12}$/;
        const usernamePattern = /^[a-zA-Z0-9_]{3,16}$/;
        const minPasswordLength = 4;

        function setupPasswordToggle(inputElement, toggleButtonElement) {
            let isPasswordVisible = false;
            
            toggleButtonElement.addEventListener('click', function() {
                isPasswordVisible = !isPasswordVisible;
                
                if (isPasswordVisible) {
                    inputElement.type = 'text';
                    toggleButtonElement.textContent = 'ÈöêËóè';
                    toggleButtonElement.classList.add('active');
                } else {
                    inputElement.type = 'password';
                    toggleButtonElement.textContent = 'ÊòæÁ§∫';
                    toggleButtonElement.classList.remove('active');
                }
            });
        }

        if (passwordInput && togglePasswordBtn) {
            setupPasswordToggle(passwordInput, togglePasswordBtn);
        }
        if (passwordConfirmInput && togglePasswordConfirmBtn) {
            setupPasswordToggle(passwordConfirmInput, togglePasswordConfirmBtn);
        }
        
        async function handleRegistration(e) {
            e.preventDefault();
            
            const formData = new FormData(registerForm);
            const qq = formData.get('qq');
            const username = formData.get('username');
            const password = formData.get('password');
            const passwordConfirm = formData.get('password_confirm');

            if (password !== passwordConfirm) {
                alert('‰∏§Ê¨°ËæìÂÖ•ÁöÑÂØÜÁ†Å‰∏ç‰∏ÄËá¥ÔºåËØ∑Ê£ÄÊü•„ÄÇ');
                return;
            }
            if (!qqPattern.test(qq)) {
                alert('ËØ∑ËæìÂÖ•‰∏Ä‰∏™ÊúâÊïàÁöÑQQÂè∑ÔºÅ');
                return;
            }
            if (!usernamePattern.test(username)) {
                alert('Áî®Êà∑ÂêçÊó†Êïà„ÄÇÂøÖÈ°ª‰∏∫3-16‰ΩçÁöÑÂ≠óÊØç„ÄÅÊï∞Â≠óÊàñ‰∏ãÂàíÁ∫ø„ÄÇ');
                return;
            }
            if (password.length < minPasswordLength) {
                alert('ÂØÜÁ†ÅÂ§™Áü≠„ÄÇÊúÄÂ∞èÈïøÂ∫¶‰∏∫4‰∏™Â≠óÁ¨¶„ÄÇ');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Ê≠£Âú®Êèê‰∫§...';
            resultMessage.style.display = 'block';
            resultMessage.className = 'result-processing';
            resultMessage.textContent = 'Ê≠£Âú®Ê≥®ÂÜåÔºåËØ∑Á®çÂêé...';

            try {
                const response = await fetch('./minecraft/reg/reg.php', {
                    method: 'POST',
                    body: formData,
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.message || 'ÊúçÂä°Âô®ÂèëÁîüÊú™Áü•ÈîôËØØ„ÄÇ');
                }

                resultMessage.innerHTML = result.message;
                resultMessage.className = result.success ? 'result-success' : 'result-fail';

            } catch (error) {
                console.error("Ê≥®ÂÜåÂ§±Ë¥•:", error);
                resultMessage.innerHTML = "Ê≥®ÂÜåÂ§±Ë¥•Ôºö" + error.message;
                resultMessage.className = 'result-fail';
            
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Ê≥®ÂÜåÂπ∂ÁªëÂÆöQQ';
            }
        }

        if (registerForm) {
            registerForm.addEventListener('submit', handleRegistration);
        }
    })();
    </script>
</body>
</html>
