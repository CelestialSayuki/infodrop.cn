<!DOCTYPE html>
<html lang="zh-CN" style="height: 100%">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="../../public-static/css/new.css" />
  <style type="text/css">
    .main-content {
      padding: 20px;
      transition: opacity 0.5s ease-out;
    }
    .card {
      margin-bottom: 20px;
    }
    .retext {
      text-align: center;
      font-size: 1.2rem;
      font-weight: 500;
      margin-top: 10px;
      margin-bottom: 0;
      color: var(--light-text-secondary);
      width: 100%;
    }
    hr {
      border: 0;
      height: 2px;
      background-color: rgba(0, 0, 0, 0.1);
      max-width: 1500px;
      margin: 25px auto;
      }
    #mainLayout {
        margin: 0;
    }
    .macos-window.dark-mode .retext,
    html.dark-mode .retext {
      color: var(--dark-text-secondary);
    }
    .macos-window.dark-mode hr,
    html.dark-mode hr {
      background-color: rgba(255, 255, 255, 0.2);
    }
    .macos-window.dark-mode .card,
    html.dark-mode .card {
      box-shadow: 0 2px 4px rgba(255, 255, 255, 0.05);
    }
    @media (max-width: 768px) {
        .main-content {
            padding: 5px;
        }
        .card {
            margin: 0;
        }
    }
  </style>
</head>
<body style="margin: 0;" id="mainLayout">
  <div class="main-content" style="opacity: 0;">
    <div class="card">
      <div id="container_3DMark_A" style="width: 100%;"></div>
      <div class="retext width_float">A系列</div>
      <div id="container_3DMark_M" style="width: 100%;"></div>
      <div class="retext width_float">M系列</div>
    </div>
  </div>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.6.0/echarts.min.js"></script>
  <script type="text/javascript">
  (() => {
      let chartInstances = {};
      let allChartData = null;
      const createTooltipFormatter = () => {
        return function (params) {
            if (!params || params.length === 0) { return; }
            let deviceName = params[0].name;
            let tooltipHtml = deviceName + '<br/>';
            params.forEach(param => {
                let seriesName = param.seriesName;
                let color = param.color;
                let data = param.data;
                if (data && (data.value !== null && data.value !== '' && data.value !== undefined)) {
                    let score = data.value;
                    let ci = data.ci || 0;
                    tooltipHtml += `
                        <span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:${color};"></span>
                        ${seriesName}: <b>${score}</b> (± ${ci})<br/>
                    `;
                }
            });
            return tooltipHtml;
        }
      };
      const renderAllCharts = () => {
          if (!allChartData) {
              return;
          }
          let currentLegends = {
              '3DMark_A': chartInstances['3DMark_A'] ? chartInstances['3DMark_A'].getOption().legend[0].selected : null,
              '3DMark_M': chartInstances['3DMark_M'] ? chartInstances['3DMark_M'].getOption().legend[0].selected : null
          };
          Object.values(chartInstances).forEach(chart => chart.dispose());
          chartInstances = {};
          const currentTheme = document.documentElement.classList.contains('dark-mode') ? 'dark' : 'light';
          const heightPerRow = 18;
          const baseHeight = 80;
          const dom_3d_a = document.getElementById('container_3DMark_A');
          const dom_3d_m = document.getElementById('container_3DMark_M');
          if (dom_3d_a) {
              const rowCount = allChartData.threemark_a.yAxis.length;
              dom_3d_a.style.height = `${(rowCount * heightPerRow) + baseHeight}px`;
          }
          if (dom_3d_m) {
              const rowCount = allChartData.threemark_m.yAxis.length;
              dom_3d_m.style.height = `${(rowCount * heightPerRow) + baseHeight}px`;
          }
          if (dom_3d_a) {
              var myChart_3DMark_A = echarts.init(dom_3d_a, currentTheme, { renderer: 'svg', useDirtyRect: false });
              chartInstances['3DMark_A'] = myChart_3DMark_A;
              var option_3DMark_A;
              const colors_a = ["#FFC000", "#EEB422", '#EEC900', '#CDAD00', '#2E8B57', '#3CB371', '#98FB98'];
              option_3DMark_A = {
                  backgroundColor: 'transparent',
                  color: colors_a,
                  title: { text: '3DMark'},
                  tooltip: {
                      trigger: 'axis',
                      axisPointer: { type: 'shadow' },
                      formatter: createTooltipFormatter()
                  },
                  legend: {
                      bottom: 30, right: 0, type: 'scroll', orient: 'vertical', textStyle: { fontSize: 11 },
                      selected: {
                          'Wild Life Extreme': false,
                          'Solar Bay': false,
                          'Steel Nomad Light': true,
                          'Solar Bay Extreme': false,
                          'Wild Life': false,
                          'Sling Shot OpenGL': false,
                          'Sling Shot Metal': false
                      }
                  },
                  grid: { left: '3%', right: '8%', bottom: '10', containLabel: true },
                  xAxis: { type: 'value', boundaryGap: [0, 0], axisLabel: { textStyle: { fontSize: "11" } } },
                  yAxis: { type: 'category', data: allChartData.threemark_a.yAxis, axisLabel: { textStyle: { fontSize: "11" } } },
                  series: [
                      { name: 'Wild Life Extreme', type: 'bar', data: allChartData.threemark_a.wle, itemStyle: { normal: { label: { show: true, color: '#808080', fontSize: 11, fontWeight: 'bold', position: 'right' }, barBorderRadius: [0, 20, 20, 0] } } },
                      { name: 'Solar Bay', type: 'bar', data: allChartData.threemark_a.sb, itemStyle: { normal: { label: { show: true, color: '#808080', fontSize: 11, fontWeight: 'bold', position: 'right' }, barBorderRadius: [0, 20, 20, 0] } } },
                      { name: 'Steel Nomad Light', type: 'bar', data: allChartData.threemark_a.snl, itemStyle: { normal: { label: { show: true, color: '#808080', fontSize: 11, fontWeight: 'bold', position: 'right' }, barBorderRadius: [0, 20, 20, 0] } } },
                      { name: 'Solar Bay Extreme', type: 'bar', data: allChartData.threemark_a.sbe, itemStyle: { normal: { label: { show: true, color: '#808080', fontSize: 11, fontWeight: 'bold', position: 'right' }, barBorderRadius: [0, 20, 20, 0] } } },
                      { name: 'Wild Life', type: 'bar', data: allChartData.threemark_a.wl, itemStyle: { normal: { label: { show: true, color: '#808080', fontSize: 11, fontWeight: 'bold', position: 'right' }, barBorderRadius: [0, 20, 20, 0] } } },
                      { name: 'Sling Shot OpenGL', type: 'bar', data: allChartData.threemark_a.sse30, itemStyle: { normal: { label: { show: true, color: '#808080', fontSize: 11, fontWeight: 'bold', position: 'right' }, barBorderRadius: [0, 20, 20, 0] } } },
                      { name: 'Sling Shot Metal', type: 'bar', data: allChartData.threemark_a.ssm, itemStyle: { normal: { label: { show: true, color: '#808080', fontSize: 11, fontWeight: 'bold', position: 'right' }, barBorderRadius: [0, 20, 20, 0] } } }
                  ]
              };
              if (currentLegends['3DMark_A']) {
                  option_3DMark_A.legend.selected = currentLegends['3DMark_A'];
              }
              myChart_3DMark_A.setOption(option_3DMark_A);
              updateChart_3DMark_A(option_3DMark_A.legend.selected);
              function getSortedData_3DMark_A(selectedLegend) { const { yAxis, series } = option_3DMark_A; let selectedSeries = series.filter(s => selectedLegend[s.name]); let sortData = selectedSeries.length > 0 ? selectedSeries[0].data : series[0].data; let sortedIndices = sortData.map((value, index) => ({ value: +(value.value || 0), index })).sort((a, b) => a.value - b.value).map(item => item.index); return { yAxis: sortedIndices.map(index => yAxis.data[index]), series: series.map(s => ({ ...s, data: sortedIndices.map(index => s.data[index]) })) }; }
              function updateChart_3DMark_A(selectedLegend) { const sortedData = getSortedData_3DMark_A(selectedLegend); myChart_3DMark_A.setOption({ yAxis: { data: sortedData.yAxis }, series: sortedData.series }); }
              myChart_3DMark_A.on('legendselectchanged', function (params) { const selectedLegend = params.selected; updateChart_3DMark_A(selectedLegend); });
              if ('ResizeObserver' in window) { const resizeObserver_3d_a = new ResizeObserver(() => { myChart_3DMark_A.resize(); }); resizeObserver_3d_a.observe(dom_3d_a); }
          }
          if (dom_3d_m) {
              var myChart_3DMark_M = echarts.init(dom_3d_m, currentTheme, { renderer: 'svg', useDirtyRect: false });
              chartInstances['3DMark_M'] = myChart_3DMark_M;
              var option_3DMark_M;
              const colors_m = ["#FFC000", "#EEB422", '#EEC900', '#CDAD00', '#CD9B1D', '#2E8B57', '#3CB371', '#98FB98'];
              option_3DMark_M = {
                  backgroundColor: 'transparent',
                  color: colors_m,
                  tooltip: {
                      trigger: 'axis',
                      axisPointer: { type: 'shadow' },
                      formatter: createTooltipFormatter()
                  },
                  legend: {
                      bottom: 30, right: 0, type: 'scroll', orient: 'vertical', textStyle: { fontSize: 11 },
                      selected: {
                          'Wild Life Extreme': false,
                          'Solar Bay': false,
                          'Steel Nomad Light': true,
                          'Steel Nomad': false,
                          'Solar Bay Extreme': false,
                          'Wild Life': false,
                          'Sling Shot OpenGL': false,
                          'Sling Shot Metal': false
                      }
                  },
                  grid: { left: '3%', right: '8%', bottom: '10', containLabel: true, top: '5%' },
                  xAxis: { type: 'value', boundaryGap: [0, 0], axisLabel: { textStyle: { fontSize: "11" } } },
                  yAxis: { type: 'category', data: allChartData.threemark_m.yAxis, axisLabel: { textStyle: { fontSize: "11" } } },
                  series: [
                      { name: 'Wild Life Extreme', type: 'bar', data: allChartData.threemark_m.wle, itemStyle: { normal: { label: { show: true, color: '#808080', fontSize: 11, fontWeight: 'bold', position: 'right' }, barBorderRadius: [0, 20, 20, 0] } } },
                      { name: 'Solar Bay', type: 'bar', data: allChartData.threemark_m.sb, itemStyle: { normal: { label: { show: true, color: '#808080', fontSize: 11, fontWeight: 'bold', position: 'right' }, barBorderRadius: [0, 20, 20, 0] } } },
                      { name: 'Steel Nomad Light', type: 'bar', data: allChartData.threemark_m.snl, itemStyle: { normal: { label: { show: true, color: '#808080', fontSize: 11, fontWeight: 'bold', position: 'right' }, barBorderRadius: [0, 20, 20, 0] } } },
                      { name: 'Steel Nomad', type: 'bar', data: allChartData.threemark_m.sn, itemStyle: { normal: { label: { show: true, color: '#808080', fontSize: 11, fontWeight: 'bold', position: 'right' }, barBorderRadius: [0, 20, 20, 0] } } },
                      { name: 'Solar Bay Extreme', type: 'bar', data: allChartData.threemark_m.sbe, itemStyle: { normal: { label: { show: true, color: '#808080', fontSize: 11, fontWeight: 'bold', position: 'right' }, barBorderRadius: [0, 20, 20, 0] } } },
                      { name: 'Wild Life', type: 'bar', data: allChartData.threemark_m.wl, itemStyle: { normal: { label: { show: true, color: '#808080', fontSize: 11, fontWeight: 'bold', position: 'right' }, barBorderRadius: [0, 20, 20, 0] } } },
                      { name: 'Sling Shot OpenGL', type: 'bar', data: allChartData.threemark_m.sse30, itemStyle: { normal: { label: { show: true, color: '#808080', fontSize: 11, fontWeight: 'bold', position: 'right' }, barBorderRadius: [0, 20, 20, 0] } } },
                      { name: 'Sling Shot Metal', type: 'bar', data: allChartData.threemark_m.ssm, itemStyle: { normal: { label: { show: true, color: '#808080', fontSize: 11, fontWeight: 'bold', position: 'right' }, barBorderRadius: [0, 20, 20, 0] } } }
                  ]
              };
              if (currentLegends['3DMark_M']) {
                  option_3DMark_M.legend.selected = currentLegends['3DMark_M'];
              }
              myChart_3DMark_M.setOption(option_3DMark_M);
              updateChart_3DMark_M(option_3DMark_M.legend.selected);
              function getSortedData_3DMark_M(selectedLegend) { const { yAxis, series } = option_3DMark_M; let selectedSeries = series.filter(s => selectedLegend[s.name]); let sortData = selectedSeries.length > 0 ? selectedSeries[0].data : series[0].data; let sortedIndices = sortData.map((value, index) => ({ value: +(value.value || 0), index })).sort((a, b) => a.value - b.value).map(item => item.index); return { yAxis: sortedIndices.map(index => yAxis.data[index]), series: series.map(s => ({ ...s, data: sortedIndices.map(index => s.data[index]) })) }; }
              function updateChart_3DMark_M(selectedLegend) { const sortedData = getSortedData_3DMark_M(selectedLegend); myChart_3DMark_M.setOption({ yAxis: { data: sortedData.yAxis }, series: sortedData.series }); }
              myChart_3DMark_M.on('legendselectchanged', function (params) { const selectedLegend = params.selected; updateChart_3DMark_M(selectedLegend); });
              if ('ResizeObserver' in window) { const resizeObserver_3d_m = new ResizeObserver(() => { myChart_3DMark_M.resize(); }); resizeObserver_3d_m.observe(dom_3d_m); }
          }
      };
      const initializePage = async () => {
          try {
              const response = await fetch('./apple-report/gpu/get.php');
              if (!response.ok) {
                  throw new Error(`HTTP error! status: ${response.status}`);
              }
              allChartData = await response.json();
              renderAllCharts();
              document.querySelector('.main-content').style.opacity = '1';
              const themeObserver = new MutationObserver((mutationsList) => {
                  for (const mutation of mutationsList) {
                      if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                          renderAllCharts();
                          break;
                      }
                  }
              });
              themeObserver.observe(document.documentElement, { attributes: true });
          } catch (error) {
            console.error("无法加载图表数据:", error);
          }
      };
      initializePage();
  })();
  </script>
</body>
</html>
