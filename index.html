<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="canonical" href="https://infodrop.cn/">
    <link rel="manifest" href="/manifest.json">
    <title>先进的 Apple 产品参数中心 / infodrop.cn</title>
    <meta name="description" content="infodrop.cn 是一个先进的 Apple 产品参数中心，提供关于 Apple Silicon (A系列/M系列)、iPhone、iPad、Mac 等设备的详细规格、性能跑分数据和系统兼容性信息。">
    <script>
        (function() {
            const theme = localStorage.getItem('theme');
            if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark-mode');
            }
        })();
    </script>
    <script>
        (function() {
            window.isBrowserSupported = true;
            function getBrowserInfo() {
                var ua = navigator.userAgent;
                if (ua.indexOf('Trident/') !== -1) {
                    var versionMatch = ua.match(/rv:([\d.]+)/);
                    if (versionMatch && versionMatch[1]) {
                        return { name: 'IE', version: parseInt(versionMatch[1], 10) };
                    }
                    return { name: 'IE', version: 11 };
                }
                var isSafari = ua.indexOf('Safari') !== -1 && ua.indexOf('Chrome') === -1 && ua.indexOf('Edg') === -1;
                if (isSafari) {
                    var versionMatch = ua.match(/Version\/([\d.]+)/) || ua.match(/OS (\d+)_/);
                    if (versionMatch && versionMatch[1]) {
                        return { name: 'Safari', version: parseInt(versionMatch[1], 10) };
                    }
                }
                if (ua.indexOf('Chrome') !== -1) {
                    var versionMatch = ua.match(/Chrome\/([\d.]+)/);
                    if (versionMatch && versionMatch[1]) {
                        return { name: 'Chrome', version: parseInt(versionMatch[1], 10) };
                    }
                }
                if (ua.indexOf('Firefox') !== -1) {
                    var versionMatch = ua.match(/Firefox\/([\d.]+)/);
                    if (versionMatch && versionMatch[1]) {
                        return { name: 'Firefox', version: parseInt(versionMatch[1], 10) };
                    }
                }
                return { name: 'unknown', version: 0 };
            }
            window.browserInfo = getBrowserInfo();
            var browser = window.browserInfo;
            var isUnsupported = false;
            var requiredVersion = '';
            var browserNameForDisplay = '';
            var updateTargetWord = '浏览器';
            var mainTitle = '浏览器版本过低';
            if (browser.name === 'Safari' && browser.version > 0 && browser.version < 13) {
                isUnsupported = true;
                requiredVersion = '13.0';
                browserNameForDisplay = 'Safari ' + browser.version;
                updateTargetWord = '系统浏览器';
                mainTitle = '系统版本过低';
            } else if (browser.name === 'Chrome' && browser.version > 0 && browser.version < 70) {
                isUnsupported = true;
                requiredVersion = '70';
                browserNameForDisplay = 'Chrome/Chromium ' + browser.version;
            } else if (browser.name === 'Firefox' && browser.version > 0 && browser.version < 70) {
                isUnsupported = true;
                requiredVersion = '70';
                browserNameForDisplay = 'Firefox ' + browser.version;
            } else if (browser.name === 'IE') {
                isUnsupported = true;
                requiredVersion = 'Edge、Chrome 或 Firefox 等现代浏览器';
                browserNameForDisplay = 'Internet Explorer ' + browser.version;
                mainTitle = '您的浏览器不受支持';
                updateTargetWord = '浏览器';
            }
            if (isUnsupported) {
                window.isBrowserSupported = false;
                document.addEventListener('DOMContentLoaded', function() {
                    setTimeout(function() {
                        var logo = document.querySelector('#loading-screen .apple-logo');
                        var loadingScreen = document.getElementById('loading-screen');
                        if (logo && loadingScreen) {
                            logo.style.opacity = '0';
                            setTimeout(function() {
                                var buttonHTML = '';
                                if (browser.name !== 'IE') {
                                    buttonHTML = '<p style="margin-top: 25px;"><button id="ignore-unsupported-btn" style="background-color: #555; color: #f5f5f7; border: 1px solid #777; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 0.9em; font-family: inherit;">忽略并继续访问</button></p>';
                                }
                                var errorMessageHTML =
                                    '<div id="unsupported-container" style="color: #a8a8b1; text-align: center; padding: 20px; font-family: sans-serif; max-width: 400px;">' +
                                    '<div id="prohibited-icon" style="opacity: 0; transition: opacity 0.6s ease-in; margin-bottom: 25px;">' +
                                    '<svg width="85" height="85" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">' +
                                    '<path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#777" stroke-width="1.5"/>' +
                                    '<path d="M5.5 18.5L18.5 5.5" stroke="#777" stroke-width="1.5" stroke-linecap="round"/>' +
                                    '</svg>' +
                                    '</div>' +
                                    '<div id="unsupported-message-text" style="opacity: 0; transition: opacity 0.6s ease-in 0.3s;">' +
                                    '<h1 style="color: #f5f5f7; font-size: 1.5em; margin-bottom: 1em;">' + mainTitle + '</h1>' +
                                    '<p style="font-size: 1em; line-height: 1.6;">您当前的' + updateTargetWord + ' (' + browserNameForDisplay + ') 不受支持。</p>' +
                                    '<p style="font-size: 1em; line-height: 1.6;">为了正常访问本网站，请升级或更换为' + requiredVersion + '。</p>' +
                                    buttonHTML +
                                    '</div>' +
                                    '</div>';
                                
                                var layer = document.getElementById('loading-screen-layer');
                                if (layer) {
                                    loadingScreen.innerHTML = layer.outerHTML + errorMessageHTML;
                                } else {
                                    loadingScreen.innerHTML = errorMessageHTML;
                                }
                                if (browser.name !== 'IE') {
                                    var ignoreBtn = document.getElementById('ignore-unsupported-btn');
                                    if (ignoreBtn) {
                                        ignoreBtn.addEventListener('click', function() {
                                            var screen = document.getElementById('loading-screen');
                                            if (screen) {
                                                screen.addEventListener('transitionend', function() {
                                                    if (screen) {
                                                        screen.remove();
                                                    }
                                                }, { once: true });
                                                screen.classList.add('hidden');
                                            }
                                            if (window.initializeApp) {
                                                window.initializeApp();
                                            }
                                        });
                                    }
                                }
                                var prohibitedIcon = document.getElementById('prohibited-icon');
                                var messageText = document.getElementById('unsupported-message-text');
                                if (prohibitedIcon && messageText) {
                                    setTimeout(function() {
                                        prohibitedIcon.style.opacity = '1';
                                        messageText.style.opacity = '1';
                                    }, 50);
                                }
                            }, 500);
                        }
                    }, 500);
                });
            } else {
                if (localStorage.getItem('sw_installed_version')) {
                    document.documentElement.className += ' is-preloaded';
                }
            }
        })();
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="robots" content="index, follow">
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f8f9fa">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#161b22">
    <meta name="apple-mobile-web-app-title" content="苹果产品参数">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="./public-static/css/new.css">
</head>

<body>
    <div id="loading-screen">
        <div id="loading-screen-layer"></div>
        <img class="apple-logo" src="./public-static/img/apple.svg" alt="Apple Logo">
        <div class="progress-bar-container">
            <div class="progress-bar-fill"></div>
        </div>
        <div class="loading-text"></div>
    </div>
    
    <div id="app-container">
        <aside class="sidebar">
            <ul class="sidebar-menu">
                <li>
                    <a href="#">
                        <i class="bi bi-cpu"></i>Apple Silicon</a>
                    <ul>
                        <li><a href="./apple-silicon/chip-a/">苹果 A 系列</a></li>
                        <li><a href="./apple-silicon/chip-s/">苹果 S 系列</a></li>
                        <li><a href="./apple-silicon/chip-m/">苹果 M 系列</a></li>
                        <li><a href="./apple-silicon/chip-r/">苹果 R 系列</a></li>
                        <li><a href="./apple-silicon/chip-t/">苹果 T 系列</a></li>
                        <li><a href="./apple-silicon/chip-u/">苹果 U 系列</a></li>
                        <li><a href="./apple-silicon/chip-w/">苹果 W 系列</a></li>
                        <li><a href="./apple-silicon/chip-h/">苹果 H 系列</a></li>
                        <li><a href="./apple-silicon/chip-c/">苹果 C 系列</a></li>
                        <li><a href="./apple-silicon/chip-coprocessor/">协处理器</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#"><i class="bi bi-apple"></i>Apple 设备</a>
                    <ul>
                        <li>
                            <a href="#">Mac 系列</a>
                            <ul class="sub-menu">
                                <li><a href="./apple-device/mac/macbook/">MacBook</a></li>
                                <li><a href="./apple-device/mac/macbook-air/">MacBook Air</a></li>
                                <li><a href="./apple-device/mac/macbook-pro/">MacBook Pro</a></li>
                                <li><a href="./apple-device/mac/imac/">iMac</a></li>
                                <li><a href="./apple-device/mac/mac-mini/">Mac mini</a></li>
                                <li><a href="./apple-device/mac/mac-studio/">Mac Studio</a></li>
                                <li><a href="./apple-device/mac/mac-pro/">Mac Pro</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#">iPad 系列</a>
                            <ul class="sub-menu">
                                <li><a href="./apple-device/ipad/ipad-pro/">iPad Pro</a></li>
                                <li><a href="./apple-device/ipad/ipad-air/">iPad Air</a></li>
                                <li><a href="./apple-device/ipad/ipad/">iPad</a></li>
                                <li><a href="./apple-device/ipad/ipad-mini/">iPad mini</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#">Watch 系列</a>
                            <ul class="sub-menu">
                                <li><a href="./apple-device/watch/watch-ultra/">AW Ultra</a></li>
                                <li><a href="./apple-device/watch/watch-series/">AW Series</a></li>
                                <li><a href="./apple-device/watch/watch-se/">AW SE</a></li>
                            </ul>
                        </li>
                        <li><a href="./apple-device/iphone/">iPhone</a></li>
                        <li><a href="./apple-device/vision/">Vision</a></li>
                        <li><a href="./apple-device/airpods/">AirPods</a></li>
                        <li><a href="./apple-device/homepod/">HomePod</a></li>
                        <li><a href="./apple-device/tv/">Apple TV</a></li>
                        <li><a href="./apple-device/ipod/">iPod touch</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#"><i class="bi bi-motherboard"></i>其他参数</a>
                    <ul>
                        <li><a href="./apple-device/iphone/cmos.">iPhone 摄像头</a></li>
                        <li><a href="./apple-other/battery/">电池详细信息</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#"><i class="bi bi-tools"></i>苹果工具</a>
                    <ul>
                        <li><a href="./apple-tools/support/">系统兼容情况</a></li>
                        <li><a href="./apple-tools/resources/">苹果资源汇总</a></li>
                        <li><a href="/apple-tools/model">型号查询</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#"><i class="bi bi-bar-chart-line"></i>测试与结果</a>
                    <ul>
                        <li><a href="./apple-report/cpu/">CPU 跑分报表</a></li>
                        <li><a href="./apple-report/gpu/">GPU 跑分报表</a></li>
                        <li><a href="./apple-report/ai/">AI 跑分报表</a></li>
                        <li><a href="./apple-report/frequency-voltage/">DFVS 频率电压表</a></li>
                        <li><a href="./apple-report/latency-test/">缓存延迟测试</a></li>
                        <li><a href="./apple-report/latency-result/">缓存测试结果</a></li>
                        <li><a href="./apple-report/disk/">Disk 读写性能</a></li>
                        <li><a href="./apple-report/speedometer-test/" class="no-mac-window" target="_blank">Web 性能测试</a></li>
                        <li><a href="./apple-report/speedometer-result/">Web 测试结果</a></li>
                    </ul>
                </li>
                <li>
                    <a href="/auth"><i class="bi bi-person-check"></i>QQ进群认证</a>
                </li>
                <li>
                    <a href="#"><i class="bi bi-terminal"></i>后台</a>
                    <ul>
                        <li><a href="/console/speedometer">Speedometer 成绩管理</a></li>
                        <li><a href="/console/latency">缓存成绩管理</a></li>
                        <li><a href="/console/dvfs">DVFS 数据上传</a></li>
                    </ul>
                </li>
            </ul>
        </aside>
        <header class="main-header">
            <div class="top_left_logo">
                <button id="hamburger-btn" class="hamburger-btn" aria-label="Toggle menu">
                    <i class="bi bi-list"></i>
                </button>
                <a href="index.html">
                    <img src="./favicon.ico" height="30px" width="30px" alt="网站 Logo">
                </a>
                <div class="top_title" id="top_title">先进的 Apple 产品参数中心 / infodrop.cn</div>
            </div>
            <div class="top_right_menu">
                <div id="version-container" style="position: relative;">
                    <button type="button" id="version-display" style="background:none; border:none; padding:0; color:inherit; font:inherit; cursor:pointer; text-align: left;"></button>
                    <div id="version-popup" class="version-popup">
                        <div>本地版本：<span id="local-version-info">未知</span></div>
                        <div>远程版本：<span id="remote-version-info">查询中...</span></div>
                        <div class="update-switch-container">
                            <span>自动更新</span>
                            <label class="switch">
                                <input type="checkbox" id="update-toggle">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div id="update-notes-container" style="display: none;">
                            <div class="update-notes-title">本次更新</div>
                            <ul id="update-notes-list"></ul>
                        </div>
                    </div>
                </div>
                <a href="https://www.github.com/CelestialSayuki/infodrop.cn">源码</a>
                <button id="theme-toggle-btn" class="theme-toggle-btn" aria-label="切换主题">
                    <i class="bi bi-circle-half" title="跟随系统"></i>
                    <i class="bi bi-sun-fill" title="浅色模式"></i>
                    <i class="bi bi-moon-stars-fill" title="深色模式"></i>
                </button>
            </div>
        </header>
        <main class="main-content">
            <div class="main-content-scroller">
                <div class="hero-banner">
                    <img src="/public-static/img/2025-devices.webp" class="hero-banner-image" alt="产品横幅图">
                    <h1>先进的 Apple 产品参数中心</h1>
                </div>
                <div class="title" id="divdown1" style="display: none;">
                    <strong>倒计时 (Apple Special Event - Awe dropping.)🥳</strong>
                    <br>
                    <span>北京时间 2025 年 9 月 10 日凌晨 1 点 ( 太平洋时间 2025 年 9 月 9 日上午 10 点 )</span>
                </div>
                <div class="div" id="divdown2" style="display: none;">加载中......</div>
                <div class="title">
                    <strong>未来工作</strong>
                    <br>
                    <span>说明：针对 infodrop.cn 的改造，以求更加完美的体验。</span>
                </div>
                <div class="card">
                    <ul>
                        <li><span>更新成绩</span></li>
                        <li><span>支持各种测试提交成绩</span></li>
                        <li><span>整理Beats设备</span></li>
                    </ul>
                </div>
                <div class="title">
                    <strong>媒体账号</strong>
                    <br>
                    <span>说明：关于本站维护者其他媒体的信息，网站内容错误或建议可通过下方渠道进行私信反馈。</span>
                </div>
                <div class="card">
                    <b style="font-style:oblique;">开发者Bilibili：</b>
                    <a href="https://space.bilibili.com/514518697">Celestial紗雪</a>
                    <br>
                    <b style="font-style:oblique;">开发者Twitter：</b>
                    <a href="https://x.com/CelestialSayuki">@CelestialSayuki</a>
                    <br>
                    <b style="font-style:oblique;">开发者E-mail：</b>CelestialSayuki@qq.com
                    <br>
                    <b style="font-style:oblique;">开发者Telegram：</b>
                    <a href="https://t.me/CelestialSayuki">@CelestialSayuki</a>
                    <br>
                    <b style="font-style:oblique;">运行维护E-mail：</b>wxcznb@qq.com
                    <br>
                    <b style="font-style:oblique;">运行维护Bilibili：</b>
                    <a href="https://space.bilibili.com/504306154">laobamac</a>
                    <br>
                </div>
                <div class="title">
                    <strong>运行信息</strong>
                    <br>
                    <span>说明：没有 SimpleHac 的赞助，本网站几乎无法承担前期运营成本，感谢 SimpleHac 对本项目的支持。</span>
                </div>
                <div class="card" style="display: flex; align-items: center; justify-content: space-between;">
                    <div>
                        <b style="font-style:oblique;">云服务赞助：</b>
                        <a href="https://space.bilibili.com/504306154">SimpleHac 团队</a>
                        <br>
                        <b style="font-style:oblique;">运行维护：</b>
                        <a href="https://github.com/laobamac">laobamac</a>
                        <br>
                        <b style="font-style:oblique;">爱发电支持：</b>
                        <a href="https://afdian.com/a/laobamac">SimpleHac 团队</a>
                    </div>
                    <img src="./public-static/img/simplehac.webp" alt="SimpleHac" class="sponsor-logo">
                </div>
                <div class="title">
                    <strong>更新记录</strong>
                    <br>
                    <span>说明：网站收录的信息不定期更新以保证正确性，该处显示当前网站的更新日志。</span>
                </div>
                <div class="card">
                    <ul id="update-history-list">
                        <li><span>2025.09.07：修正了 iPod touch 3 的参数，缩小了缓存测试有效判定区间，优化了无效算法，修复若干 bug</span></li>
                        <li><span>2025.09.06：正式上线！修复了进群验证的一处安全漏洞，增加了暗黑模式的开关，修正了 MacBook Air 2018/2019, MacBook 2017 Refresh 的颜色，临时扩大了缓存延迟测试数据有效的判定区间，可能导致更低质量数据的出现，修改了本弹窗的透明度，网页加载改为多线程</span></li>
                        <li><span>2025.09.05：禁止IE进入</span></li>
                        <li><span>2025.09.04：删除 ?force 调试 flag, 因为已经确认 iOS 13 工作的稳定性，增加更新管理器</span></li>
                        <li><span>2025.09.03：微调移动端样式，更正 MacPro4,1 支持信息，增加窗口限位检查</span></li>
                        <li><span>2025.09.01：修复了表格对齐bug，部分修复 Safari 14 兼容性，修复 Safari 12 滚动问题</span></li>
                        <li class="more-btn-li">
                            <button type="button" class="show-more-btn" id="show-more-updates">点击加载更多</button>
                        </li>
                    </ul>
                    <template id="more-updates-template">
                        <li><span>2025.08.31：新增旧版浏览器忽略选项，方便旧设备进入。</span></li>
                        <li><span>2025.08.28：新增两个调试选项，在地址后面增加 ?force 可以强制使用本网站自带的webp解析器，?offline 可以屏蔽更新，同时修复了一些webp图片在旧设备无法显示的bug，放弃Safari 12 兼容，维护手机界面</span></li>
                        <li><span>2025.08.27：修复了旧版浏览器 UI 边距问题</span></li>
                        <li><span>2025.08.26：调整比较界面样式，为 iOS 14 及以下设备增加 Web 解析器（Beta）</span></li>
                        <li><span>2025.08.25：调整 3DMark GPU展示方法，优化了手机版的部分界面，修复部分 Javascript 无法运行的 bug，优化了进群考试界面点击</span></li>
                        <li><span>2025.08.23：修复若干bug</span></li>
                        <li><span>2025.08.22：新增型号查询，补充部分Solar Bay Extreme成绩</span></li>
                        <li><span>2025.08.21：系统支持页面修正了iMac部分机型的错误数据，M1 芯片设备收录 A2620，修改 CPU 跑分表格</span></li>
                        <li><span>2025.08.18：系统支持页面合并了部分机型</span></li>
                        <li><span>2025.08.17：系统支持页面增加悬停</span></li>
                        <li><span>2025.08.09：尝试修复系统支持页面</span></li>
                        <li><span>2025.08.08：补充 Apple Watch SiP 的标识符，更正 Apple Watch Edition，iMac，DTK，Apple H1/H2 信息，增强网站兼容性，为窗口按钮增加鼠标靠近图标</span></li>
                        <li><span>2025.08.07：苹果资源页新增内容</span></li>
                        <li><span>2025.08.06：新增 dvfs 上传</span></li>
                        <li><span>2025.08.05：删除最小化功能，增加网页缓存，删掉了不能用的最小化功能</span></li>
                        <li><span>2025.08.04：入群考试上线，删掉老旧文档</span></li>
                        <li><span>2025.08.01：新增原生缓存测试软件</span></li>
                        <li><span>2025.07.31：新增启动界面</span></li>
                        <li><span>2025.07.30：新增 Speedometer 测试</span></li>
                        <li><span>2025.07.28：新增 Mac mini DTK 的数据，修复若干bug，为进群考试实施做准备</span></li>
                        <li><span>2025.07.27：将QQ讨论群临时移至主页显示</span></li>
                        <li><span>2025.07.25：默认使用最大化窗口，修复若干UI Bug，新增电池详细信息页面</span></li>
                        <li><span>2025.07.10：删除设备发售价格，官网序列号查询</span></li>
                        <li><span>2025.07.08：重写了比较页面</span></li>
                        <li><span>2025.07.07：移除依赖 hubweb.cn 的支持文件</span></li>
                        <li><span>2025.07.05：支持窗口化显示</span></li>
                        <li><span>2025.06.27：开始逐步替换UI</span></li>
                        <li><span>2025.06.23：本网站与 hubweb.cn 分离，修改了系统支持页面的样式，增加Xserve等机器统计，删掉所有广告，测试对比和统计报表合并，删除交互式色域比较，删除频率测试，删除打赏列表，允许复制文本</span></li>
                    </template>
                </div>
                <div class="footer-content">
                    <div class="copyright">
                        <a href="https://beian.miit.gov.cn/" class="beian-link" target="_blank">豫ICP备2024082352号-3</a>
                        <span> | </span>
                        <span>This Website Is Not Affiliated With Apple Inc. © 2025 CelestialSayuki. All Rights Reserved.</span>
                    </div>
                </div>
                <svg id="animation-svg-container" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;"></svg>
            </div>
        </main>
        <div class="overlay" id="overlay"></div>
    </div>
    
    <script type="module" src="public-static/js/macui.js"></script>
    <script src="https://unpkg.com/webp-hero@0.0.2/dist-cjs/polyfills.js"></script>
    <script src="https://unpkg.com/webp-hero@0.0.2/dist-cjs/webp-hero.bundle.js"></script>
    <script>
        (async function() {
            let updateIsPending = false;
            function formatRemainingTime(ms) {
                if (ms === null || !isFinite(ms) || ms <= 0) {
                    return '正在计算剩余时间...';
                }
                const totalSeconds = Math.round(ms / 1000);
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                if (minutes > 0) {
                    return `还剩大约${minutes}分钟`;
                }
                return `还剩大约${seconds}秒`;
            }
            
            const hideLoadingScreen = () => {
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen && !loadingScreen.classList.contains('hidden')) {
                    loadingScreen.addEventListener('transitionend', () => {
                        if (loadingScreen) {
                            loadingScreen.remove();
                        }
                    }, { once: true });
                    loadingScreen.classList.add('hidden');
                }
            };
            const runLoadingAnimation = () => {
                const loadingScreen = document.getElementById('loading-screen');
                if (!loadingScreen) return;
                document.documentElement.classList.remove('is-preloaded');
                loadingScreen.style.display = 'flex';
                const progressBarContainer = loadingScreen.querySelector('.progress-bar-container');
                const progressBarFill = loadingScreen.querySelector('.progress-bar-fill');
                const loadingText = loadingScreen.querySelector('.loading-text');
                
                if (progressBarContainer) {
                    progressBarContainer.style.opacity = '1';
                }
                if (progressBarFill) {
                    progressBarFill.style.transition = 'none';
                    progressBarFill.style.width = '0%';
                }
                if (loadingText) {
                    loadingText.textContent = '正在准备更新...';
                    loadingText.style.opacity = '1';
                }
            };
            const simulateLoadingProgress = () => {
                const progressBarFill = document.querySelector('.progress-bar-fill');
                const loadingText = document.querySelector('.loading-text');
                if (progressBarFill && loadingText) {
                    loadingText.textContent = '正在启动...';
                    setTimeout(() => {
                        progressBarFill.style.transition = 'width 1.2s cubic-bezier(0.65, 0, 0.35, 1)';
                        progressBarFill.style.width = '100%';
                    }, 50);

                    setTimeout(hideLoadingScreen, 1500);
                } else {
                    hideLoadingScreen();
                }
            };
            async function checkForUpdates(registration) {
                if (localStorage.getItem('updates_paused') === 'true') {
                    return false;
                }
                const localVersion = localStorage.getItem('sw_installed_version');
                if (!localVersion) return false;
                try {
                    const response = await fetch('./public-static/version.json', { cache: 'no-store' });
                    const serverConfig = await response.json();
                    const serverVersion = serverConfig.version;
                    if (localVersion !== serverVersion) {
                        updateIsPending = true;
                        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
                        if (!isStandalone) {
                            runLoadingAnimation();
                            const loadingText = document.querySelector('.loading-text');
                            if(loadingText) loadingText.textContent = '正在更新...';
                        }
                        localStorage.removeItem('sw_installed_version');
                            
                        if (registration && registration.update) {
                            await registration.update();
                        }
                        return true;
                    }
                } catch (error) {
                    console.error('更新检查失败:', error);
                }
                return false;
            }
            
            window.initializeApp = async function() {
                const localVersion = localStorage.getItem('sw_installed_version');
                const versionElement = document.getElementById('version-display');
                
                const versionPopup = document.getElementById('version-popup');
                const localVersionInfo = document.getElementById('local-version-info');
                const remoteVersionInfo = document.getElementById('remote-version-info');
                const updateToggle = document.getElementById('update-toggle');

                if (localVersion) {
                    localVersionInfo.textContent = localVersion;
                    versionElement.textContent = `前端版本：${localVersion}`;
                } else {
                    versionElement.textContent = '查询版本中...';
                }
                
                const updatesPaused = localStorage.getItem('updates_paused') === 'true';
                updateToggle.checked = !updatesPaused;

                updateToggle.addEventListener('change', () => {
                    if (updateToggle.checked) {
                        localStorage.removeItem('updates_paused');
                        console.log('自动更新已开启。');
                    } else {
                        localStorage.setItem('updates_paused', 'true');
                        console.log('自动更新已暂停。');
                    }
                });

                versionElement.addEventListener('click', (event) => {
                    event.stopPropagation();
                    versionPopup.classList.toggle('show');
                });

                versionPopup.addEventListener('click', (event) => {
                    event.stopPropagation();
                });

                window.addEventListener('click', () => {
                    if (versionPopup.classList.contains('show')) {
                        versionPopup.classList.remove('show');
                    }
                });

                fetch('./public-static/version.json', { cache: 'no-store' })
                .then(response => response.json())
                .then(data => {
                    if (data.version) {
                        remoteVersionInfo.textContent = data.version;
                        if (!localVersion) {
                            versionElement.textContent = `前端版本：${data.version}`;
                        }
                    }
                    const updateNotesContainer = document.getElementById('update-notes-container');
                    const updateNotesList = document.getElementById('update-notes-list');
                    if (data.notes && Array.isArray(data.notes) && data.notes.length > 0) {
                        updateNotesList.innerHTML = '';
                        data.notes.forEach(noteText => {
                            const li = document.createElement('li');
                            li.textContent = noteText;
                            updateNotesList.appendChild(li);
                        });
                        updateNotesContainer.style.display = 'block';
                    } else {
                        updateNotesContainer.style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('获取远程版本信息失败:', error);
                    remoteVersionInfo.textContent = '获取失败';
                    document.getElementById('update-notes-container').style.display = 'none';
                });

                if (!('serviceWorker' in navigator)) {
                    hideLoadingScreen();
                    return;
                }
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    if (updateIsPending) {
                        const loadingScreen = document.getElementById('loading-screen');
                        if (loadingScreen && !loadingScreen.classList.contains('hidden')) {
                            loadingScreen.addEventListener('transitionend', () => {
                                window.location.reload();
                            }, { once: true });
                            loadingScreen.classList.add('hidden');
                        } else {
                            window.location.reload();
                        }
                    }
                });
                navigator.serviceWorker.addEventListener('message', event => {
                    if (!event.data) return;
                    if (event.data.type === 'GET_UPDATE_SETTING') {
                        const isPaused = localStorage.getItem('updates_paused') === 'true';
                        if (event.source) {
                            event.source.postMessage({
                                type: 'UPDATE_SETTING_RESPONSE',
                                isPaused: isPaused
                            });
                        }
                        return;
                    }
                    const progressBarFill = document.querySelector('.progress-bar-fill');
                    const progressBarContainer = document.querySelector('.progress-bar-container');
                    const loadingText = document.querySelector('.loading-text');
                    if (event.data.type === 'CACHE_PROGRESS' || event.data.type === 'CURRENT_PROGRESS') {
                        const { percent, estimatedRemainingTime } = event.data.payload;
                        if (progressBarFill) {
                            if (parseInt(progressBarFill.style.width) !== percent) {
                                progressBarFill.style.transition = 'none';
                                progressBarFill.style.width = `${percent}%`;
                            }
                        }
                        if (progressBarContainer) progressBarContainer.style.opacity = '1';
                        if (loadingText) {
                            loadingText.textContent = formatRemainingTime(estimatedRemainingTime);
                            loadingText.style.opacity = '1';
                        }
                    }
                    if (event.data.type === 'CACHE_COMPLETE') {
                        if (progressBarFill) {
                            progressBarFill.style.transition = 'width 0.2s ease-out';
                            progressBarFill.style.width = '100%';
                        }
                        localStorage.setItem('sw_installed_version', event.data.payload.version);
                        setTimeout(() => {
                            if (!updateIsPending) {
                                hideLoadingScreen();
                            }
                        }, 500);
                    }
                });
                navigator.serviceWorker.register('./sw.js').then(async (registration) => {
                    if (registration.waiting) {
                        if (!new URL(window.location.href).searchParams.has('offline')) {
                            registration.waiting.postMessage({ type: 'SKIP_WAITING' });
                        }
                    }
                    registration.onupdatefound = () => {
                        const installingWorker = registration.installing;
                        if (installingWorker) {
                            installingWorker.onstatechange = () => {
                                if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    if (!new URL(window.location.href).searchParams.has('offline')) {
                                        installingWorker.postMessage({ type: 'SKIP_WAITING' });
                                    }
                                }
                            };
                        }
                    };
                    async function isCacheValid() {
                        if (!window.caches) return false;
                        const localVersion = localStorage.getItem('sw_installed_version');
                        if (!localVersion) return false;
                        try {
                            const cacheName = `project-mammoth-cache-${localVersion}`;
                            const cache = await caches.open(cacheName);
                            const response = await cache.match('./index.html');
                            if (response === undefined) {
                                localStorage.removeItem('sw_installed_version');
                                return false;
                            }
                            return true;
                        } catch {
                            localStorage.removeItem('sw_installed_version');
                            return false;
                        }
                    }
                    const cacheIsValid = await isCacheValid();
                    const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
                    const updateStarted = await checkForUpdates(registration);
                    if (updateStarted) {
                    } else if (isStandalone) {
                        runLoadingAnimation();
                        simulateLoadingProgress();
                    } else if (cacheIsValid) {
                        hideLoadingScreen();
                    } else {
                        runLoadingAnimation();
                        const sw = registration.active || registration.waiting || registration.installing;
                        if (sw) {
                            sw.postMessage({ type: 'GET_PROGRESS' });
                        }
                    }
                }).catch(err => {
                    console.error('Service Worker 注册失败:', err);
                    hideLoadingScreen();
                });
            };

            document.addEventListener('DOMContentLoaded', () => {
                if (window.isBrowserSupported === false) return;
                window.initializeApp();
            });
        })();
        function applyOrientationClass() {
            if (!screen || !screen.orientation) {
                document.body.classList.add('portrait-mode');
                return;
            }
            var orientationType = screen.orientation.type;
            var body = document.body;
            body.classList.remove('landscape-notch-left', 'landscape-notch-right', 'portrait-mode');
            switch (orientationType) {
                case 'landscape-primary':
                    body.classList.add('landscape-notch-left');
                    break;
                case 'landscape-secondary':
                    body.classList.add('landscape-notch-right');
                    break;
                default:
                    body.classList.add('portrait-mode');
                    break;
            }
        }
        document.addEventListener('DOMContentLoaded', applyOrientationClass);
        if (screen && screen.orientation) {
            screen.orientation.addEventListener('change', applyOrientationClass);
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            if (!themeToggleBtn) return;
            const icons = {
                auto: themeToggleBtn.querySelector('.bi-circle-half'),
                light: themeToggleBtn.querySelector('.bi-sun-fill'),
                dark: themeToggleBtn.querySelector('.bi-moon-stars-fill')
            };
            const themeStates = ['auto', 'light', 'dark'];
            let currentTheme = localStorage.getItem('theme') || 'auto';
            function applyTheme(theme) {
                if (theme === 'dark' || (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark-mode');
                } else {
                    document.documentElement.classList.remove('dark-mode');
                }
                const isDark = document.documentElement.classList.contains('dark-mode');
                document.querySelectorAll('.macos-window').forEach(win => {
                    win.classList.toggle('dark-mode', isDark);
                });
                Object.values(icons).forEach(icon => icon.style.display = 'none');
                if (icons[theme]) {
                    icons[theme].style.display = 'block';
                }
                localStorage.setItem('theme', theme);
                currentTheme = theme;
            }
            themeToggleBtn.addEventListener('click', () => {
                const currentIndex = themeStates.indexOf(currentTheme);
                const nextIndex = (currentIndex + 1) % themeStates.length;
                applyTheme(themeStates[nextIndex]);
            });
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                if (currentTheme === 'auto') {
                    applyTheme('auto');
                }
            });
            applyTheme(currentTheme);
        });
    </script>
</body>
</html>
